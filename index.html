<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Graviton Analytics â€“ MS FinCap</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
    }
  </script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body { font-family: 'Inter', system-ui, sans-serif; }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-200">
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef } = React;

/* ------------------------------------------------------------
   GLOBAL LAYOUT
------------------------------------------------------------ */
function App() {
  const [active, setActive] = useState("cxo");
  const [darkMode, setDarkMode] = useState(() => {
    const saved = localStorage.getItem('darkMode');
    return saved ? JSON.parse(saved) : false;
  });

  useEffect(() => {
    localStorage.setItem('darkMode', JSON.stringify(darkMode));
    if (darkMode) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }, [darkMode]);

  const toggleDarkMode = () => setDarkMode(!darkMode);

  return (
    <div className="min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 flex font-sans transition-colors duration-200">
      {/* Sidebar */}
      <aside className="w-64 bg-white dark:bg-gray-800 border-r border-gray-300 dark:border-gray-700 p-5 hidden md:block transition-colors duration-200">
        <div className="flex items-center gap-3 mb-8">
          <div className="h-10 w-10 bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-200 flex items-center justify-center rounded-xl text-xl font-bold">G</div>
          <div>
            <div className="text-sm font-semibold text-gray-900 dark:text-white">Graviton Analytics</div>
            <div className="text-xs text-gray-600 dark:text-gray-300">MS FinCap</div>
          </div>
        </div>
        <nav className="space-y-2 text-sm">
          {[
            { key: "cxo", label: "CXO Overview" },
            { key: "business", label: "Business Performance" },
            { key: "collections", label: "Collections" },
            { key: "credit", label: "Credit & Risk" },
            { key: "ops", label: "Operations" },
          ].map(item => (
            <button
              key={item.key}
              onClick={() => setActive(item.key)}
              className={`w-full text-left px-4 py-2 rounded-lg transition ${active === item.key ? "bg-indigo-600 text-white shadow-md" : "text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-700"}`}
            >
              {item.label}
            </button>
          ))}
        </nav>
      </aside>

      {/* Main Panel */}
      <main className="flex-1 p-6 overflow-auto">
        <div className="flex justify-between items-center mb-6">
          <h1 className="text-xl font-semibold text-gray-900 dark:text-white">
            {active === "cxo" && "CXO / Management Overview"}
            {active === "business" && "Business Performance Dashboard"}
            {active === "collections" && "Collections Dashboard"}
            {active === "credit" && "Credit & Risk Dashboard"}
            {active === "ops" && "Operations Dashboard"}
          </h1>
          <div className="flex items-center gap-3">
            <button 
              onClick={toggleDarkMode}
              className="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
              aria-label="Toggle dark mode"
            >
              {darkMode ? (
                <svg className="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fillRule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clipRule="evenodd" />
                </svg>
              ) : (
                <svg className="w-5 h-5 text-gray-700" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                </svg>
              )}
            </button>
            <span className="text-sm text-gray-700 dark:text-gray-200 font-medium">Logged in as CXO</span>
            <div className="h-9 w-9 rounded-full bg-indigo-200 dark:bg-indigo-800 flex items-center justify-center text-indigo-800 dark:text-indigo-100 font-semibold">C</div>
          </div>
        </div>
        <div className="bg-white dark:bg-gray-800 shadow rounded-xl p-6 border border-gray-200 dark:border-gray-700 transition-colors duration-200">
          {active === "cxo" && <CxoDashboard />}
          {active === "business" && <BusinessDashboard />}
          {active === "collections" && <CollectionsDashboard />}
          {active === "credit" && <CreditDashboard />}
          {active === "ops" && <OpsDashboard />}
        </div>
      </main>
    </div>
  );
}

/* ------------------------------------------------------------
   REUSABLE COMPONENTS
------------------------------------------------------------ */
function Card({ title, children }) {
  return (
    <div className="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-sm rounded-xl p-5 mb-6 transition-colors duration-200">
      {title && <h2 className="text-sm font-semibold text-gray-800 dark:text-gray-100 mb-3 uppercase tracking-wide">{title}</h2>}
      {children}
    </div>
  );
}

function KPI({ label, value, tooltip }) {
  return (
    <div className="relative group bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4 shadow-sm cursor-default transition-colors duration-200 hover:shadow-md">
      <div className="text-xs text-gray-600 dark:text-gray-300 uppercase flex items-center gap-1 font-semibold">
        {label} <span className="text-gray-500 dark:text-gray-400">â“˜</span>
      </div>
      <div className="text-xl font-bold mt-1 text-gray-900 dark:text-white">{value}</div>
      <div className="absolute hidden group-hover:block z-20 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 shadow-lg text-xs text-gray-800 dark:text-gray-200 p-3 rounded-lg w-52 top-16 left-0">
        {tooltip}
      </div>
    </div>
  );
}

function LineChart({ data, labels, datasets, height = 260 }) {
  const canvasRef = useRef(null);
  const chartRef = useRef(null);

  useEffect(() => {
    if (canvasRef.current) {
      if (chartRef.current) {
        chartRef.current.destroy();
      }
      
      const isDark = document.documentElement.classList.contains('dark');
      const textColor = isDark ? '#d1d5db' : '#374151';
      const gridColor = isDark ? '#374151' : '#e5e7eb';
      
      const ctx = canvasRef.current.getContext('2d');
      chartRef.current = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: datasets
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top',
              labels: {
                color: textColor
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: textColor
              },
              grid: {
                color: gridColor
              }
            },
            y: {
              beginAtZero: false,
              ticks: {
                color: textColor
              },
              grid: {
                color: gridColor
              }
            }
          }
        }
      });
    }
    
    return () => {
      if (chartRef.current) {
        chartRef.current.destroy();
      }
    };
  }, [data, labels, datasets]);

  return <div style={{ height: `${height}px`, position: 'relative' }}><canvas ref={canvasRef}></canvas></div>;
}

function BarChart({ data, labels, datasets, height = 260, horizontal = false }) {
  const canvasRef = useRef(null);
  const chartRef = useRef(null);

  useEffect(() => {
    if (canvasRef.current) {
      if (chartRef.current) {
        chartRef.current.destroy();
      }
      
      const isDark = document.documentElement.classList.contains('dark');
      const textColor = isDark ? '#d1d5db' : '#374151';
      const gridColor = isDark ? '#374151' : '#e5e7eb';
      
      const ctx = canvasRef.current.getContext('2d');
      chartRef.current = new Chart(ctx, {
        type: horizontal ? 'bar' : 'bar',
        data: {
          labels: labels,
          datasets: datasets
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          indexAxis: horizontal ? 'y' : 'x',
          plugins: {
            legend: {
              display: datasets.length > 1,
              position: 'top',
              labels: {
                color: textColor
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: textColor
              },
              grid: {
                color: gridColor
              }
            },
            y: {
              beginAtZero: true,
              ticks: {
                color: textColor
              },
              grid: {
                color: gridColor
              }
            }
          }
        }
      });
    }
    
    return () => {
      if (chartRef.current) {
        chartRef.current.destroy();
      }
    };
  }, [data, labels, datasets, horizontal]);

  return <div style={{ height: `${height}px`, position: 'relative' }}><canvas ref={canvasRef}></canvas></div>;
}

function InteractiveBarChart({ data, labels, datasets, height = 260, horizontal = false, onClick }) {
  const canvasRef = useRef(null);
  const chartRef = useRef(null);

  useEffect(() => {
    if (canvasRef.current) {
      if (chartRef.current) {
        chartRef.current.destroy();
      }
      
      const isDark = document.documentElement.classList.contains('dark');
      const textColor = isDark ? '#d1d5db' : '#374151';
      const gridColor = isDark ? '#374151' : '#e5e7eb';
      
      const ctx = canvasRef.current.getContext('2d');
      chartRef.current = new Chart(ctx, {
        type: horizontal ? 'bar' : 'bar',
        data: {
          labels: labels,
          datasets: datasets
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          indexAxis: horizontal ? 'y' : 'x',
          onClick: (event, elements) => {
            if (elements.length > 0 && onClick) {
              const index = elements[0].index;
              const label = labels[index];
              onClick(label);
            }
          },
          onHover: (event, elements) => {
            event.native.target.style.cursor = elements.length > 0 ? 'pointer' : 'default';
          },
          plugins: {
            legend: {
              display: datasets.length > 1,
              position: 'top',
              labels: {
                color: textColor
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: textColor
              },
              grid: {
                color: gridColor
              }
            },
            y: {
              beginAtZero: true,
              ticks: {
                color: textColor
              },
              grid: {
                color: gridColor
              }
            }
          }
        }
      });
    }
    
    return () => {
      if (chartRef.current) {
        chartRef.current.destroy();
      }
    };
  }, [data, labels, datasets, horizontal, onClick]);

  return <div style={{ height: `${height}px`, position: 'relative' }}><canvas ref={canvasRef}></canvas></div>;
}

/* ------------------------------------------------------------
   CXO DASHBOARD
------------------------------------------------------------ */
function CxoDashboard() {
  const KPI_DATA = { aum: "â‚¹418 Cr", disb: "â‚¹31.2 Cr", wirr: "18.7%", par30: "4.6%", ce: "97.4%", gnpa: "2.0%" };
  const branches = [{branch:"Jaipur Main",disb:"â‚¹8.8 Cr",wirr:"18.4%",ce:"98.1%"},{branch:"Udaipur",disb:"â‚¹7.1 Cr",wirr:"18.9%",ce:"96.9%"},{branch:"Jodhpur",disb:"â‚¹6.4 Cr",wirr:"18.1%",ce:"96.5%"},{branch:"Ajmer",disb:"â‚¹4.4 Cr",wirr:"17.6%",ce:"95.8%"}];

  return (
    <div>
      <div className="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-6 gap-4 mb-6">
        <KPI label="AUM" value={KPI_DATA.aum} tooltip="AUM (Assets Under Management): Total outstanding principal of all active loans." />
        <KPI label="Monthly Disbursement" value={KPI_DATA.disb} tooltip="Total loan amount disbursed during the selected period." />
        <KPI label="WIRR" value={KPI_DATA.wirr} tooltip="Weighted average return rate of all disbursed loans." />
        <KPI label="PAR 30+" value={KPI_DATA.par30} tooltip="Portion of loan book overdue by more than 30 days." />
        <KPI label="CE" value={KPI_DATA.ce} tooltip="Collection Efficiency: % of total EMI demand collected." />
        <KPI label="Gross NPA" value={KPI_DATA.gnpa} tooltip="Percentage of loans overdue by more than 90 days." />
      </div>

      <div className="grid grid-cols-1 xl:grid-cols-2 gap-6">
        <Card title="Business & WIRR Trend">
          <LineChart 
            labels={["Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct"]}
            datasets={[
              {
                label: 'Disb (â‚¹ Cr)',
                data: [18.4, 21.2, 23.5, 25.1, 26.9, 29.3, 31.2],
                borderColor: '#4f46e5',
                backgroundColor: '#4f46e5',
                tension: 0.3
              },
              {
                label: 'WIRR (%)',
                data: [18.1, 17.8, 18.3, 18.7, 18.4, 18.9, 18.7],
                borderColor: '#16a34a',
                backgroundColor: '#16a34a',
                tension: 0.3
              }
            ]}
          />
        </Card>

        <Card title="Bucket-wise Portfolio (PAR)">
          <BarChart 
            labels={["Current", "X1", "X2", "X3+", "NPA"]}
            datasets={[
              {
                label: 'Portfolio %',
                data: [88.5, 6.1, 3.5, 1.5, 0.4],
                backgroundColor: '#6366f1'
              }
            ]}
          />
        </Card>
      </div>

      <Card title="Collection Efficiency Trend">
        <LineChart 
          labels={["Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct"]}
          datasets={[
            {
              label: 'CE (%)',
              data: [96.8, 97.3, 96.5, 97.8, 97.1, 97.4, 97.4],
              borderColor: '#0891b2',
              backgroundColor: '#0891b2',
              tension: 0.3
            }
          ]}
        />
      </Card>

      <Card title="Branch Leaderboard">
        <table className="w-full text-sm">
          <thead className="text-gray-700 dark:text-gray-200 text-xs uppercase font-semibold">
            <tr><th className="pb-2 text-left">Branch</th><th className="pb-2 text-center">Disbursement</th><th className="pb-2 text-center">WIRR</th><th className="pb-2 text-center">CE</th></tr>
          </thead>
          <tbody>
            {branches.map((b,i)=>(
              <tr key={i} className="border-t border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-gray-800 dark:text-gray-100">
                <td className="py-2 font-medium">{b.branch}</td>
                <td className="text-center">{b.disb}</td>
                <td className="text-center">{b.wirr}</td>
                <td className="text-center">{b.ce}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </Card>
    </div>
  );
}

/* ------------------------------------------------------------
   BUSINESS DASHBOARD
------------------------------------------------------------ */
function BusinessDashboard() {
  // Real data from the tabular dashboard
  const rawData = [
    { state: "GJ", branch: "Direct", loginCount_Nov: 69, loginAmount_Nov: 8.71, loginCount_Oct: 69, loginAmount_Oct: 7.76, freshFile_Nov: 0, freshFile_Oct: 0.30, partDisb: 0.12, totalDisb: 0.42, cancel: 0.00, netAch: 0.42, grossDisb: 0.59, sanctionCancel: 0.00, sanctionCount: 15, sanctionAmount: 0.66, wirr_Nov: 20.58, wirr_Oct: 20.73, wip_Count: 21, wip_Amount: 3.87, sud_Count: 10, sud_Amount: 0.62, manpower_Active: 16, manpower_OnNotice: 4, bm_Active: 6, bm_OnNotice: 0, login_Percent: 20, fdUnit: 13, fdPercent: 65 },
    { state: "MP", branch: "Dayanand Bhai", loginCount_Nov: 302, loginAmount_Nov: 25.55, loginCount_Oct: 266, loginAmount_Oct: 22.17, freshFile_Nov: 16, freshFile_Oct: 0.57, partDisb: 0.25, totalDisb: 0.82, cancel: 0.00, netAch: 0.82, grossDisb: 1.69, sanctionCancel: 0.00, sanctionCount: 28, sanctionAmount: 1.37, wirr_Nov: 23.84, wirr_Oct: 22.67, wip_Count: 145, wip_Amount: 11.58, sud_Count: 26, sud_Amount: 1.33, manpower_Active: 96, manpower_OnNotice: 16, bm_Active: 27, bm_OnNotice: 3, login_Percent: 14, fdUnit: 98, fdPercent: 88 },
    { state: "Raj", branch: "Prakash Veer", loginCount_Nov: 296, loginAmount_Nov: 25.76, loginCount_Oct: 303, loginAmount_Oct: 26.31, freshFile_Nov: 32, freshFile_Oct: 1.30, partDisb: 0.40, totalDisb: 1.70, cancel: 0.06, netAch: 1.65, grossDisb: 3.62, sanctionCancel: 0.10, sanctionCount: 33, sanctionAmount: 1.97, wirr_Nov: 22.26, wirr_Oct: 20.36, wip_Count: 104, wip_Amount: 9.74, sud_Count: 34, sud_Amount: 1.99, manpower_Active: 133, manpower_OnNotice: 28, bm_Active: 45, bm_OnNotice: 7, login_Percent: 30, fdUnit: 137, fdPercent: 85 },
    { state: "UP", branch: "Direct", loginCount_Nov: 46, loginAmount_Nov: 3.92, loginCount_Oct: 31, loginAmount_Oct: 2.73, freshFile_Nov: 2, freshFile_Oct: 0.09, partDisb: 0.00, totalDisb: 0.09, cancel: 0.00, netAch: 0.09, grossDisb: 0.00, sanctionCancel: 0.00, sanctionCount: 1, sanctionAmount: 0.05, wirr_Nov: 23.42, wirr_Oct: null, wip_Count: 36, wip_Amount: 3.23, sud_Count: 3, sud_Amount: 0.16, manpower_Active: 16, manpower_OnNotice: 2, bm_Active: 6, bm_OnNotice: 0, login_Percent: 17, fdUnit: 16, fdPercent: 89 },
    { state: "Jaipur HO", branch: "-", loginCount_Nov: 0, loginAmount_Nov: 0.00, loginCount_Oct: 0, loginAmount_Oct: 0.00, freshFile_Nov: 0, freshFile_Oct: 0.00, partDisb: 0.00, totalDisb: 0.00, cancel: 0.00, netAch: 0.00, grossDisb: 0.31, sanctionCancel: 0.00, sanctionCount: 0, sanctionAmount: 0.00, wirr_Nov: null, wirr_Oct: null, wip_Count: 0, wip_Amount: 0.00, sud_Count: 0, sud_Amount: 0.00, manpower_Active: 0, manpower_OnNotice: 0, bm_Active: 0, bm_OnNotice: 0, login_Percent: 0, fdUnit: 0, fdPercent: 0 },
    { state: "PATRON", branch: "-", loginCount_Nov: 2, loginAmount_Nov: 0.29, loginCount_Oct: 0, loginAmount_Oct: 0.00, freshFile_Nov: 0, freshFile_Oct: 0.00, partDisb: 0.00, totalDisb: 0.00, cancel: 0.00, netAch: 0.00, grossDisb: 0.00, sanctionCancel: 0.00, sanctionCount: 0, sanctionAmount: 0.00, wirr_Nov: null, wirr_Oct: null, wip_Count: 0, wip_Amount: 0.00, sud_Count: 0, sud_Amount: 0.00, manpower_Active: 0, manpower_OnNotice: 0, bm_Active: 0, bm_OnNotice: 0, login_Percent: 0, fdUnit: 0, fdPercent: 0 },
    { state: "Paharthan", branch: "-", loginCount_Nov: 0, loginAmount_Nov: 0.00, loginCount_Oct: 0, loginAmount_Oct: 0.00, freshFile_Nov: 0, freshFile_Oct: 0.00, partDisb: 0.00, totalDisb: 0.00, cancel: 0.00, netAch: 0.00, grossDisb: 0.00, sanctionCancel: 0.09, sanctionCount: 0, sanctionAmount: 0.00, wirr_Nov: null, wirr_Oct: null, wip_Count: 0, wip_Amount: 0.00, sud_Count: 0, sud_Amount: 0.00, manpower_Active: 0, manpower_OnNotice: 0, bm_Active: 0, bm_OnNotice: 0, login_Percent: 0, fdUnit: 0, fdPercent: 0 },
    { state: "THIRUPATHI", branch: "-", loginCount_Nov: 20, loginAmount_Nov: 2.90, loginCount_Oct: 16, loginAmount_Oct: 1.11, freshFile_Nov: 2, freshFile_Oct: 0.11, partDisb: 0.05, totalDisb: 0.16, cancel: 0.00, netAch: 0.16, grossDisb: 0.15, sanctionCancel: 0.00, sanctionCount: 4, sanctionAmount: 0.31, wirr_Nov: 22.06, wirr_Oct: 25.79, wip_Count: 4, wip_Amount: 0.31, sud_Count: 3, sud_Amount: 0.14, manpower_Active: 0, manpower_OnNotice: 0, bm_Active: 0, bm_OnNotice: 0, login_Percent: 0, fdUnit: 0, fdPercent: 0 },
    { state: "PRITANISH", branch: "-", loginCount_Nov: 2, loginAmount_Nov: 0.90, loginCount_Oct: 2, loginAmount_Oct: 0.30, freshFile_Nov: 0, freshFile_Oct: 0.00, partDisb: 0.00, totalDisb: 0.00, cancel: 0.00, netAch: 0.00, grossDisb: 0.00, sanctionCancel: 0.00, sanctionCount: 0, sanctionAmount: 0.00, wirr_Nov: null, wirr_Oct: null, wip_Count: 0, wip_Amount: 0.00, sud_Count: 0, sud_Amount: 0.00, manpower_Active: 0, manpower_OnNotice: 0, bm_Active: 0, bm_OnNotice: 0, login_Percent: 0, fdUnit: 0, fdPercent: 0 }
  ];

  const [filters, setFilters] = useState({
    state: "All",
    branch: "All",
    dateRange: 30,
    compareWith: "Previous Period"
  });

  const [activeView, setActiveView] = useState("overview");

  // Calculate totals and filtered data
  const filteredData = rawData.filter(item => {
    if (filters.state !== "All" && item.state !== filters.state) return false;
    if (filters.branch !== "All" && item.branch !== filters.branch) return false;
    return true;
  });

  const totals = filteredData.reduce((acc, item) => ({
    loginCount_Nov: acc.loginCount_Nov + item.loginCount_Nov,
    loginAmount_Nov: acc.loginAmount_Nov + item.loginAmount_Nov,
    loginCount_Oct: acc.loginCount_Oct + item.loginCount_Oct,
    sanctionCount: acc.sanctionCount + item.sanctionCount,
    sanctionAmount: acc.sanctionAmount + item.sanctionAmount,
    totalDisb: acc.totalDisb + item.totalDisb,
    wip_Count: acc.wip_Count + item.wip_Count,
    wip_Amount: acc.wip_Amount + item.wip_Amount
  }), { loginCount_Nov: 0, loginAmount_Nov: 0, loginCount_Oct: 0, sanctionCount: 0, sanctionAmount: 0, totalDisb: 0, wip_Count: 0, wip_Amount: 0 });

  const approvalRate = totals.loginCount_Nov > 0 ? ((totals.sanctionCount / totals.loginCount_Nov) * 100).toFixed(1) : 0;
  const conversionRate = totals.loginCount_Nov > 0 ? ((totals.totalDisb / totals.loginAmount_Nov) * 100).toFixed(1) : 0;

  const states = ["All", ...new Set(rawData.map(d => d.state))];
  const branches = ["All", ...new Set(rawData.filter(d => filters.state === "All" || d.state === filters.state).map(d => d.branch))];

  return (
    <div>
      {/* Filter Panel */}
      <div className="bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-4 mb-6 border border-indigo-200 dark:border-gray-600">
        <div className="flex items-center gap-2 mb-3">
          <svg className="w-5 h-5 text-indigo-700 dark:text-indigo-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
          </svg>
          <h3 className="text-sm font-semibold text-gray-800 dark:text-white">Filters & Analysis Controls</h3>
        </div>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div>
            <label className="text-xs text-gray-700 dark:text-gray-200 mb-1 block font-semibold">State</label>
            <select 
              value={filters.state}
              onChange={(e) => setFilters({...filters, state: e.target.value, branch: "All"})}
              className="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm focus:ring-2 focus:ring-indigo-500 dark:text-gray-200"
            >
              {states.map(s => <option key={s} value={s}>{s}</option>)}
            </select>
          </div>
          <div>
            <label className="text-xs text-gray-700 dark:text-gray-200 mb-1 block font-semibold">Branch</label>
            <select 
              value={filters.branch}
              onChange={(e) => setFilters({...filters, branch: e.target.value})}
              className="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm focus:ring-2 focus:ring-indigo-500 text-gray-800 dark:text-gray-100"
            >
              {branches.map(b => <option key={b} value={b}>{b}</option>)}
            </select>
          </div>
          <div>
            <label className="text-xs text-gray-700 dark:text-gray-200 mb-1 block font-semibold">Days Range</label>
            <div className="flex items-center gap-2">
              <input 
                type="range" 
                min="7" 
                max="90" 
                value={filters.dateRange}
                onChange={(e) => setFilters({...filters, dateRange: parseInt(e.target.value)})}
                className="w-full"
              />
              <span className="text-sm font-bold text-indigo-700 dark:text-indigo-300 min-w-[45px]">{filters.dateRange}d</span>
            </div>
          </div>
          <div>
            <label className="text-xs text-gray-700 dark:text-gray-200 mb-1 block font-semibold">Compare With</label>
            <select 
              value={filters.compareWith}
              onChange={(e) => setFilters({...filters, compareWith: e.target.value})}
              className="w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm focus:ring-2 focus:ring-indigo-500 text-gray-800 dark:text-gray-100"
            >
              <option>Previous Period</option>
              <option>Same Period Last Year</option>
            </select>
          </div>
        </div>
      </div>

      {/* View Tabs */}
      <div className="flex gap-2 mb-6 overflow-x-auto">
        {[
          { key: "overview", label: "Overview", icon: "ðŸ“Š" },
          { key: "comparative", label: "Comparative Analytics", icon: "ðŸ“ˆ" },
          { key: "approval", label: "Approval Analysis", icon: "âœ…" },
          { key: "funnel", label: "Conversion Funnel", icon: "ðŸ”„" },
          { key: "ro", label: "RO Productivity", icon: "ðŸ‘¥" },
          { key: "tat", label: "TAT Analysis", icon: "â±ï¸" }
        ].map(view => (
          <button
            key={view.key}
            onClick={() => setActiveView(view.key)}
            className={`px-4 py-2 rounded-lg text-sm font-semibold transition whitespace-nowrap ${
              activeView === view.key 
                ? "bg-indigo-600 text-white shadow-lg" 
                : "bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700 border border-gray-200 dark:border-gray-600"
            }`}
          >
            {view.icon} {view.label}
          </button>
        ))}
      </div>

      {/* Content based on active view */}
      {activeView === "overview" && (
        <>
          <div className="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-6 gap-4 mb-6">
            <KPI label="Total Logins" value={totals.loginCount_Nov} tooltip="Total new loan applications logged in the selected period." />
            <KPI label="Sanctions" value={totals.sanctionCount} tooltip="Loans approved by credit in the selected period." />
            <KPI label="Disbursements" value={`â‚¹${totals.totalDisb.toFixed(2)} Cr`} tooltip="Total amount disbursed and booked." />
            <KPI label="Approval Rate" value={`${approvalRate}%`} tooltip="Sanctions Ã· Logins â€” measures credit efficiency." />
            <KPI label="Conversion" value={`${conversionRate}%`} tooltip="Disbursement to Login conversion rate." />
            <KPI label="WIP Files" value={totals.wip_Count} tooltip="Files currently in the pipeline (Work in Progress)." />
          </div>

          <div className="grid grid-cols-1 xl:grid-cols-2 gap-6">
            <Card title="Login vs Sanction vs Disbursement (Current Period)">
              <BarChart 
                labels={filteredData.map(d => d.state)}
                datasets={[
                  {
                    label: 'Logins',
                    data: filteredData.map(d => d.loginCount_Nov),
                    backgroundColor: '#4f46e5'
                  },
                  {
                    label: 'Sanctions',
                    data: filteredData.map(d => d.sanctionCount),
                    backgroundColor: '#10b981'
                  }
                ]}
                height={280}
              />
            </Card>

            <Card title="State-wise Disbursement Amount (â‚¹ Cr)">
              <BarChart 
                labels={filteredData.map(d => d.state)}
                datasets={[
                  {
                    label: 'Disbursement',
                    data: filteredData.map(d => d.totalDisb),
                    backgroundColor: '#f59e0b'
                  }
                ]}
                height={280}
              />
            </Card>
          </div>

          <Card title="Detailed Performance Table">
            <div className="overflow-x-auto">
              <table className="w-full text-sm">
                <thead className="text-gray-700 dark:text-gray-200 text-xs uppercase bg-gray-50 dark:bg-gray-700/50 font-semibold">
                  <tr>
                    <th className="py-3 px-4 text-left">State</th>
                    <th className="py-3 px-4 text-left">Branch</th>
                    <th className="py-3 px-4 text-center">Logins (Nov)</th>
                    <th className="py-3 px-4 text-center">Logins (Oct)</th>
                    <th className="py-3 px-4 text-center">Sanctions</th>
                    <th className="py-3 px-4 text-center">Disb (â‚¹ Cr)</th>
                    <th className="py-3 px-4 text-center">WIRR %</th>
                    <th className="py-3 px-4 text-center">WIP Count</th>
                    <th className="py-3 px-4 text-center">Approval %</th>
                  </tr>
                </thead>
                <tbody>
                  {filteredData.map((d, i) => {
                    const approval = d.loginCount_Nov > 0 ? ((d.sanctionCount / d.loginCount_Nov) * 100).toFixed(1) : 0;
                    return (
                      <tr key={i} className="border-t border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-100">
                        <td className="py-3 px-4 font-semibold">{d.state}</td>
                        <td className="py-3 px-4">{d.branch}</td>
                        <td className="py-3 px-4 text-center">{d.loginCount_Nov}</td>
                        <td className="py-3 px-4 text-center">{d.loginCount_Oct}</td>
                        <td className="py-3 px-4 text-center">{d.sanctionCount}</td>
                        <td className="py-3 px-4 text-center">{d.totalDisb.toFixed(2)}</td>
                        <td className="py-3 px-4 text-center">{d.wirr_Nov || '-'}</td>
                        <td className="py-3 px-4 text-center">{d.wip_Count}</td>
                        <td className="py-3 px-4 text-center">
                          <span className={`px-2 py-1 rounded text-xs font-semibold ${approval > 50 ? 'bg-green-100 dark:bg-green-900 text-green-900 dark:text-green-100' : 'bg-yellow-100 dark:bg-yellow-900 text-yellow-900 dark:text-yellow-100'}`}>
                            {approval}%
                          </span>
                        </td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
          </Card>
        </>
      )}

      {activeView === "comparative" && <ComparativeAnalytics data={filteredData} filters={filters} />}
      {activeView === "approval" && <ApprovalAnalysis data={filteredData} totals={totals} />}
      {activeView === "funnel" && <ConversionFunnel data={filteredData} totals={totals} />}
      {activeView === "ro" && <ROProductivity data={filteredData} />}
      {activeView === "tat" && <TATAnalysis data={filteredData} />}
    </div>
  );
}

// Comparative Analytics Component
function ComparativeAnalytics({ data, filters }) {
  const novData = data.reduce((acc, d) => acc + d.loginCount_Nov, 0);
  const octData = data.reduce((acc, d) => acc + d.loginCount_Oct, 0);
  const novSanc = data.reduce((acc, d) => acc + d.sanctionCount, 0);
  const octSanc = data.reduce((acc, d) => acc + d.sanctionAmount, 0);
  const novDisb = data.reduce((acc, d) => acc + d.totalDisb, 0);
  const octDisb = data.reduce((acc, d) => acc + d.grossDisb, 0);

  const changeLogin = ((novData - octData) / octData * 100).toFixed(1);
  const changeSanction = ((novSanc - octSanc) / Math.max(octSanc, 1) * 100).toFixed(1);
  const changeDisb = ((novDisb - octDisb) / Math.max(octDisb, 1) * 100).toFixed(1);

  return (
    <div>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div className="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900 dark:to-blue-800 rounded-xl p-5 border border-blue-200 dark:border-blue-700">
          <div className="text-xs text-blue-600 dark:text-blue-300 uppercase mb-2">Login Comparison</div>
          <div className="flex items-end gap-3">
            <div className="text-2xl font-bold text-blue-900 dark:text-blue-100">{novData}</div>
            <div className="text-sm text-blue-700 dark:text-blue-300">vs {octData}</div>
          </div>
          <div className={`text-sm mt-2 font-medium ${changeLogin >= 0 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`}>
            {changeLogin >= 0 ? 'â†‘' : 'â†“'} {Math.abs(changeLogin)}% from previous period
          </div>
        </div>

        <div className="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900 dark:to-green-800 rounded-xl p-5 border border-green-200 dark:border-green-700">
          <div className="text-xs text-green-600 dark:text-green-300 uppercase mb-2">Sanction Comparison</div>
          <div className="flex items-end gap-3">
            <div className="text-2xl font-bold text-green-900 dark:text-green-100">{novSanc}</div>
            <div className="text-sm text-green-700 dark:text-green-300">vs {octSanc.toFixed(0)}</div>
          </div>
          <div className={`text-sm mt-2 font-medium ${changeSanction >= 0 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`}>
            {changeSanction >= 0 ? 'â†‘' : 'â†“'} {Math.abs(changeSanction)}% from previous period
          </div>
        </div>

        <div className="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900 dark:to-purple-800 rounded-xl p-5 border border-purple-200 dark:border-purple-700">
          <div className="text-xs text-purple-600 dark:text-purple-300 uppercase mb-2">Disbursement Comparison (â‚¹ Cr)</div>
          <div className="flex items-end gap-3">
            <div className="text-2xl font-bold text-purple-900 dark:text-purple-100">{novDisb.toFixed(2)}</div>
            <div className="text-sm text-purple-700 dark:text-purple-300">vs {octDisb.toFixed(2)}</div>
          </div>
          <div className={`text-sm mt-2 font-medium ${changeDisb >= 0 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`}>
            {changeDisb >= 0 ? 'â†‘' : 'â†“'} {Math.abs(changeDisb)}% from previous period
          </div>
        </div>
      </div>

      <div className="grid grid-cols-1 xl:grid-cols-2 gap-6">
        <Card title="Login Trend: Nov vs Oct">
          <BarChart 
            labels={data.map(d => d.state)}
            datasets={[
              {
                label: 'Nov-25',
                data: data.map(d => d.loginCount_Nov),
                backgroundColor: '#4f46e5'
              },
              {
                label: 'Oct-25',
                data: data.map(d => d.loginCount_Oct),
                backgroundColor: '#94a3b8'
              }
            ]}
            height={280}
          />
        </Card>

        <Card title="Disbursement Trend: Current vs Previous">
          <BarChart 
            labels={data.map(d => d.state)}
            datasets={[
              {
                label: 'Current Period (â‚¹ Cr)',
                data: data.map(d => d.totalDisb),
                backgroundColor: '#10b981'
              },
              {
                label: 'Previous Period (â‚¹ Cr)',
                data: data.map(d => d.grossDisb),
                backgroundColor: '#94a3b8'
              }
            ]}
            height={280}
          />
        </Card>
      </div>

      <Card title="State-wise Performance Comparison">
        <div className="overflow-x-auto">
          <table className="w-full text-sm">
            <thead className="text-gray-700 dark:text-gray-200 text-xs uppercase bg-gray-50 dark:bg-gray-700/50 font-semibold">
              <tr>
                <th className="py-3 px-4 text-left">State</th>
                <th className="py-3 px-4 text-center">Login Nov</th>
                <th className="py-3 px-4 text-center">Login Oct</th>
                <th className="py-3 px-4 text-center">Change %</th>
                <th className="py-3 px-4 text-center">Sanction Nov</th>
                <th className="py-3 px-4 text-center">Disb Nov (â‚¹ Cr)</th>
                <th className="py-3 px-4 text-center">Disb Change %</th>
              </tr>
            </thead>
            <tbody>
              {data.map((d, i) => {
                const loginChange = d.loginCount_Oct > 0 ? ((d.loginCount_Nov - d.loginCount_Oct) / d.loginCount_Oct * 100).toFixed(1) : 0;
                const disbChange = d.grossDisb > 0 ? ((d.totalDisb - d.grossDisb) / d.grossDisb * 100).toFixed(1) : 0;
                return (
                  <tr key={i} className="border-t border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-100">
                    <td className="py-3 px-4 font-semibold">{d.state}</td>
                    <td className="py-3 px-4 text-center font-bold text-indigo-700 dark:text-indigo-300">{d.loginCount_Nov}</td>
                    <td className="py-3 px-4 text-center">{d.loginCount_Oct}</td>
                    <td className="py-3 px-4 text-center">
                      <span className={`font-bold ${loginChange >= 0 ? 'text-green-700 dark:text-green-300' : 'text-red-700 dark:text-red-300'}`}>
                        {loginChange >= 0 ? 'â†‘' : 'â†“'} {Math.abs(loginChange)}%
                      </span>
                    </td>
                    <td className="py-3 px-4 text-center">{d.sanctionCount}</td>
                    <td className="py-3 px-4 text-center font-semibold">{d.totalDisb.toFixed(2)}</td>
                    <td className="py-3 px-4 text-center">
                      <span className={`font-bold ${disbChange >= 0 ? 'text-green-700 dark:text-green-300' : 'text-red-700 dark:text-red-300'}`}>
                        {disbChange >= 0 ? 'â†‘' : 'â†“'} {Math.abs(disbChange)}%
                      </span>
                    </td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      </Card>
    </div>
  );
}

// Approval Analysis with Donut Chart
function ApprovalAnalysis({ data, totals }) {
  const approved = totals.sanctionCount;
  const totalLogin = totals.loginCount_Nov;
  const wip = totals.wip_Count;
  const rejected = totalLogin - approved - wip;

  return (
    <div>
      <div className="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
        <Card title="Approval Breakdown (Donut Chart)">
          <div className="flex items-center justify-center h-80">
            <DonutChart 
              data={[approved, rejected, wip]}
              labels={['Approved', 'Rejected', 'WIP']}
              colors={['#10b981', '#ef4444', '#f59e0b']}
            />
          </div>
          <div className="grid grid-cols-3 gap-3 mt-4">
            <div className="text-center p-3 bg-green-50 dark:bg-green-900/30 rounded-lg">
              <div className="text-2xl font-bold text-green-600 dark:text-green-400">{approved}</div>
              <div className="text-xs text-gray-600 dark:text-gray-400">Approved</div>
            </div>
            <div className="text-center p-3 bg-red-50 dark:bg-red-900/30 rounded-lg">
              <div className="text-2xl font-bold text-red-600 dark:text-red-400">{rejected}</div>
              <div className="text-xs text-gray-600 dark:text-gray-400">Rejected</div>
            </div>
            <div className="text-center p-3 bg-orange-50 dark:bg-orange-900/30 rounded-lg">
              <div className="text-2xl font-bold text-orange-600 dark:text-orange-400">{wip}</div>
              <div className="text-xs text-gray-600 dark:text-gray-400">WIP</div>
            </div>
          </div>
        </Card>

        <Card title="State-wise Approval Rate">
          <BarChart 
            labels={data.map(d => d.state)}
            datasets={[
              {
                label: 'Approval %',
                data: data.map(d => d.loginCount_Nov > 0 ? (d.sanctionCount / d.loginCount_Nov * 100).toFixed(1) : 0),
                backgroundColor: '#8b5cf6'
              }
            ]}
            height={280}
          />
        </Card>
      </div>

      <Card title="Detailed Approval Metrics">
        <div className="overflow-x-auto">
          <table className="w-full text-sm">
            <thead className="text-gray-700 dark:text-gray-200 text-xs uppercase bg-gray-50 dark:bg-gray-700/50 font-semibold">
              <tr>
                <th className="py-3 px-4 text-left">State</th>
                <th className="py-3 px-4 text-center">Total Files</th>
                <th className="py-3 px-4 text-center">Approved</th>
                <th className="py-3 px-4 text-center">WIP</th>
                <th className="py-3 px-4 text-center">Approval %</th>
                <th className="py-3 px-4 text-center">Avg Amount (â‚¹ Cr)</th>
              </tr>
            </thead>
            <tbody>
              {data.map((d, i) => {
                const approvalRate = d.loginCount_Nov > 0 ? (d.sanctionCount / d.loginCount_Nov * 100).toFixed(1) : 0;
                return (
                  <tr key={i} className="border-t border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-100">
                    <td className="py-3 px-4 font-semibold">{d.state}</td>
                    <td className="py-3 px-4 text-center">{d.loginCount_Nov}</td>
                    <td className="py-3 px-4 text-center text-green-700 dark:text-green-300 font-bold">{d.sanctionCount}</td>
                    <td className="py-3 px-4 text-center text-orange-700 dark:text-orange-300 font-bold">{d.wip_Count}</td>
                    <td className="py-3 px-4 text-center">
                      <div className="flex items-center justify-center gap-2">
                        <div className="w-20 bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                          <div className="bg-indigo-600 dark:bg-indigo-500 h-2 rounded-full" style={{width: `${approvalRate}%`}}></div>
                        </div>
                        <span className="font-semibold text-gray-800 dark:text-gray-100">{approvalRate}%</span>
                      </div>
                    </td>
                    <td className="py-3 px-4 text-center">{d.sanctionAmount.toFixed(2)}</td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      </Card>
    </div>
  );
}

// Conversion Funnel
function ConversionFunnel({ data, totals }) {
  const loginTotal = totals.loginCount_Nov;
  const sanctionTotal = totals.sanctionCount;
  const disbTotal = data.reduce((acc, d) => acc + d.totalDisb, 0);

  return (
    <div>
      <Card title="Login â†’ Sanction â†’ Disbursement Funnel">
        <div className="space-y-4">
          <div className="relative">
            <div className="bg-gradient-to-r from-blue-500 to-blue-600 h-20 flex items-center justify-between px-6 rounded-lg shadow-lg">
              <span className="text-white font-bold text-lg">LOGINS</span>
              <span className="text-white font-bold text-2xl">{loginTotal}</span>
            </div>
          </div>
          <div className="flex items-center justify-center">
            <div className="text-gray-600 dark:text-gray-300 font-semibold">â†“ {sanctionTotal > 0 ? ((sanctionTotal/loginTotal)*100).toFixed(1) : 0}% conversion</div>
          </div>
          <div className="relative">
            <div className="bg-gradient-to-r from-green-500 to-green-600 h-20 flex items-center justify-between px-6 rounded-lg shadow-lg" style={{width: `${(sanctionTotal/loginTotal)*100}%`, minWidth: '40%'}}>
              <span className="text-white font-bold text-lg">SANCTIONS</span>
              <span className="text-white font-bold text-2xl">{sanctionTotal}</span>
            </div>
          </div>
          <div className="flex items-center justify-center">
            <div className="text-gray-600 dark:text-gray-300 font-semibold">â†“ Disbursement stage</div>
          </div>
          <div className="relative">
            <div className="bg-gradient-to-r from-purple-500 to-purple-600 h-20 flex items-center justify-between px-6 rounded-lg shadow-lg" style={{width: `${(disbTotal/totals.loginAmount_Nov)*50}%`, minWidth: '30%'}}>
              <span className="text-white font-bold text-lg">DISBURSEMENTS</span>
              <span className="text-white font-bold text-2xl">â‚¹{disbTotal.toFixed(2)} Cr</span>
            </div>
          </div>
        </div>
      </Card>

      <div className="grid grid-cols-1 xl:grid-cols-2 gap-6 mt-6">
        <Card title="Funnel by State (Count)">
          <BarChart 
            labels={data.map(d => d.state)}
            datasets={[
              { label: 'Login', data: data.map(d => d.loginCount_Nov), backgroundColor: '#3b82f6' },
              { label: 'Sanction', data: data.map(d => d.sanctionCount), backgroundColor: '#10b981' }
            ]}
            height={280}
          />
        </Card>

        <Card title="State-wise Conversion Rates">
          <BarChart 
            labels={data.map(d => d.state)}
            datasets={[
              {
                label: 'Conversion %',
                data: data.map(d => d.loginCount_Nov > 0 ? (d.sanctionCount / d.loginCount_Nov * 100).toFixed(1) : 0),
                backgroundColor: '#8b5cf6'
              }
            ]}
            height={280}
          />
        </Card>
      </div>
    </div>
  );
}

// RO Productivity
function ROProductivity({ data }) {
  const [modalOpen, setModalOpen] = useState(false);
  const [selectedRange, setSelectedRange] = useState(null);
  const [selectedType, setSelectedType] = useState(''); // 'login' or 'disbursement'
  
  // Indian names pool
  const indianNames = [
    'Rajesh Kumar', 'Priya Sharma', 'Amit Patel', 'Sneha Desai', 'Vikram Singh',
    'Anjali Reddy', 'Arjun Mehta', 'Kavita Joshi', 'Rohit Verma', 'Neha Gupta',
    'Sanjay Kapoor', 'Pooja Nair', 'Rahul Iyer', 'Deepika Pillai', 'Karan Malhotra',
    'Swati Agarwal', 'Nitin Rao', 'Ritu Bansal', 'Manish Tiwari', 'Anita Kulkarni',
    'Suresh Pandey', 'Meena Saxena', 'Ajay Chopra', 'Sunita Mishra', 'Ashok Jain',
    'Geeta Sinha', 'Manoj Bhatt', 'Rekha Menon', 'Vijay Chauhan', 'Seema Thakur',
    'Anil Kumar', 'Madhuri Dixit', 'Ramesh Patil', 'Shilpa Shetty', 'Dinesh Karthik',
    'Nisha Agarwal', 'Sachin Tendulkar', 'Tanvi Shah', 'Prakash Yadav', 'Shruti Kapoor',
    'Harish Chandra', 'Lakshmi Iyer', 'Vishal Khanna', 'Divya Raman', 'Sunil Gavaskar',
    'Aarti Saxena', 'Gopal Krishna', 'Sarika Patil', 'Bharat Thakur', 'Isha Gupta',
    'Naveen Kumar', 'Preeti Agarwal', 'Ravi Shankar', 'Pallavi Joshi', 'Arun Sharma'
  ];

  // Simulated RO data with Indian names
  const roData = data.flatMap((d, stateIdx) => {
    const roCount = Math.max(d.manpower_Active, 1);
    const loginPerRO = Math.floor(d.loginCount_Nov / roCount);
    const disbPerRO = d.totalDisb / roCount;
    return Array.from({length: Math.min(roCount, 10)}, (_, i) => {
      const nameIdx = (stateIdx * 10 + i) % indianNames.length;
      const logins = Math.max(1, loginPerRO + Math.floor(Math.random() * 20) - 10);
      return {
        name: indianNames[nameIdx],
        state: d.state,
        branch: d.branch,
        logins: logins,
        disb: Math.max(0.05, disbPerRO + (Math.random() * 0.2 - 0.1)),
        email: `${indianNames[nameIdx].toLowerCase().replace(' ', '.')}@msfincap.com`,
        phone: `+91 ${Math.floor(Math.random() * 9000000000) + 1000000000}`
      };
    });
  }).filter(ro => ro.logins > 0);

  // Group by ranges
  const loginRanges = [
    { range: '0-10', count: roData.filter(ro => ro.logins >= 0 && ro.logins <= 10).length, data: roData.filter(ro => ro.logins >= 0 && ro.logins <= 10) },
    { range: '11-20', count: roData.filter(ro => ro.logins > 10 && ro.logins <= 20).length, data: roData.filter(ro => ro.logins > 10 && ro.logins <= 20) },
    { range: '21-30', count: roData.filter(ro => ro.logins > 20 && ro.logins <= 30).length, data: roData.filter(ro => ro.logins > 20 && ro.logins <= 30) },
    { range: '31-40', count: roData.filter(ro => ro.logins > 30 && ro.logins <= 40).length, data: roData.filter(ro => ro.logins > 30 && ro.logins <= 40) },
    { range: '40+', count: roData.filter(ro => ro.logins > 40).length, data: roData.filter(ro => ro.logins > 40) }
  ];

  const disbRanges = [
    { range: '0-0.5 Cr', count: roData.filter(ro => ro.disb <= 0.5).length, data: roData.filter(ro => ro.disb <= 0.5) },
    { range: '0.5-1 Cr', count: roData.filter(ro => ro.disb > 0.5 && ro.disb <= 1).length, data: roData.filter(ro => ro.disb > 0.5 && ro.disb <= 1) },
    { range: '1-2 Cr', count: roData.filter(ro => ro.disb > 1 && ro.disb <= 2).length, data: roData.filter(ro => ro.disb > 1 && ro.disb <= 2) },
    { range: '2+ Cr', count: roData.filter(ro => ro.disb > 2).length, data: roData.filter(ro => ro.disb > 2) }
  ];

  const handleBarClick = (type, range) => {
    setSelectedType(type);
    setSelectedRange(range);
    setModalOpen(true);
  };

  const exportToExcel = () => {
    const rangeData = selectedType === 'login' 
      ? loginRanges.find(r => r.range === selectedRange)?.data || []
      : disbRanges.find(r => r.range === selectedRange)?.data || [];
    
    let csv = 'Name,State,Branch,Login Count,Disbursement (â‚¹ Cr),Email,Phone\n';
    rangeData.forEach(ro => {
      csv += `${ro.name},${ro.state},${ro.branch},${ro.logins},${ro.disb.toFixed(2)},${ro.email},${ro.phone}\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `RO_Productivity_${selectedRange.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
    window.URL.revokeObjectURL(url);
  };

  const getModalData = () => {
    if (selectedType === 'login') {
      return loginRanges.find(r => r.range === selectedRange)?.data || [];
    } else {
      return disbRanges.find(r => r.range === selectedRange)?.data || [];
    }
  };

  return (
    <div>
      <div className="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
        <Card title="Login Productivity Distribution">
          <InteractiveBarChart 
            labels={loginRanges.map(r => r.range)}
            datasets={[
              {
                label: 'Number of ROs',
                data: loginRanges.map(r => r.count),
                backgroundColor: '#6366f1'
              }
            ]}
            height={280}
            onClick={(label) => handleBarClick('login', label)}
          />
          <div className="mt-3 text-xs text-gray-500 dark:text-gray-400 text-center">
            X-axis: Login file ranges | Y-axis: Number of ROs | Click on bars to view details
          </div>
        </Card>

        <Card title="Disbursement Productivity">
          <InteractiveBarChart 
            labels={['0-0.5 Cr', '0.5-1 Cr', '1-2 Cr', '2+ Cr']}
            datasets={[
              {
                label: 'Number of ROs',
                data: disbRanges.map(r => r.count),
                backgroundColor: '#10b981'
              }
            ]}
            height={280}
            onClick={(label) => handleBarClick('disbursement', label)}
          />
          <div className="mt-3 text-xs text-gray-500 dark:text-gray-400 text-center">
            X-axis: Disbursement ranges | Y-axis: Number of ROs | Click on bars to view details
          </div>
        </Card>
      </div>

      {/* Modal */}
      {modalOpen && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={() => setModalOpen(false)}>
          <div className="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden" onClick={(e) => e.stopPropagation()}>
            <div className="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
              <div>
                <h2 className="text-xl font-bold text-gray-900 dark:text-white">
                  RO Details - {selectedRange}
                </h2>
                <p className="text-sm text-gray-600 dark:text-gray-300 mt-1">
                  {selectedType === 'login' ? 'Login Count Range' : 'Disbursement Range'} â€¢ {getModalData().length} ROs
                </p>
              </div>
              <div className="flex gap-2">
                <button 
                  onClick={exportToExcel}
                  className="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium text-sm transition flex items-center gap-2"
                >
                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
                  Export to Excel
                </button>
                <button 
                  onClick={() => setModalOpen(false)}
                  className="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-lg font-medium text-sm transition"
                >
                  Close
                </button>
              </div>
            </div>
            <div className="overflow-auto max-h-[calc(90vh-140px)] p-6">
              <table className="w-full text-sm">
                <thead className="sticky top-0 bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-200 text-xs uppercase font-semibold">
                  <tr>
                    <th className="py-3 px-4 text-left">#</th>
                    <th className="py-3 px-4 text-left">Name</th>
                    <th className="py-3 px-4 text-left">State</th>
                    <th className="py-3 px-4 text-left">Branch</th>
                    <th className="py-3 px-4 text-center">Login Count</th>
                    <th className="py-3 px-4 text-center">Disbursement (â‚¹ Cr)</th>
                    <th className="py-3 px-4 text-left">Email</th>
                    <th className="py-3 px-4 text-left">Phone</th>
                  </tr>
                </thead>
                <tbody>
                  {getModalData().map((ro, i) => (
                    <tr key={i} className="border-t border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-100">
                      <td className="py-3 px-4 text-gray-600 dark:text-gray-400">{i + 1}</td>
                      <td className="py-3 px-4 font-semibold">{ro.name}</td>
                      <td className="py-3 px-4">{ro.state}</td>
                      <td className="py-3 px-4">{ro.branch}</td>
                      <td className="py-3 px-4 text-center font-semibold">{ro.logins}</td>
                      <td className="py-3 px-4 text-center font-semibold">{ro.disb.toFixed(2)}</td>
                      <td className="py-3 px-4 text-xs">{ro.email}</td>
                      <td className="py-3 px-4 text-xs">{ro.phone}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      )}

      <Card title="Individual RO Performance Report">
        <div className="overflow-x-auto">
          <table className="w-full text-sm">
            <thead className="text-gray-700 dark:text-gray-200 text-xs uppercase bg-gray-50 dark:bg-gray-700/50 font-semibold">
              <tr>
                <th className="py-3 px-4 text-left">RO Name</th>
                <th className="py-3 px-4 text-left">State</th>
                <th className="py-3 px-4 text-center">Login Count</th>
                <th className="py-3 px-4 text-center">Disbursement (â‚¹ Cr)</th>
                <th className="py-3 px-4 text-center">Productivity</th>
              </tr>
            </thead>
            <tbody>
              {roData.slice(0, 15).map((ro, i) => (
                <tr key={i} className="border-t border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-100">
                  <td className="py-3 px-4 font-semibold">{ro.name}</td>
                  <td className="py-3 px-4">{ro.state}</td>
                  <td className="py-3 px-4 text-center">{ro.logins}</td>
                  <td className="py-3 px-4 text-center">{ro.disb.toFixed(2)}</td>
                  <td className="py-3 px-4 text-center">
                    <span className={`px-2 py-1 rounded text-xs font-semibold ${
                      ro.logins > 30 ? 'bg-green-100 dark:bg-green-900 text-green-900 dark:text-green-100' : 
                      ro.logins > 15 ? 'bg-yellow-100 dark:bg-yellow-900 text-yellow-900 dark:text-yellow-100' : 
                      'bg-red-100 dark:bg-red-900 text-red-900 dark:text-red-100'
                    }`}>
                      {ro.logins > 30 ? 'High' : ro.logins > 15 ? 'Medium' : 'Low'}
                    </span>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </Card>
    </div>
  );
}

// TAT Analysis
function TATAnalysis({ data }) {
  // Simulated TAT data
  const tatData = [
    { stage: 'Login â†’ Sanction', avg: 2.3, target: 3, states: data.map(d => ({state: d.state, days: 2 + Math.random() * 2})) },
    { stage: 'Login â†’ Decision', avg: 2.8, target: 4, states: data.map(d => ({state: d.state, days: 2.5 + Math.random() * 2})) },
    { stage: 'Sanction â†’ Disbursement', avg: 3.2, target: 5, states: data.map(d => ({state: d.state, days: 3 + Math.random() * 2})) },
    { stage: 'SOP Compliance', avg: 1.8, target: 2, states: data.map(d => ({state: d.state, days: 1.5 + Math.random() * 1})) }
  ];

  return (
    <div>
      <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 mb-6">
        {tatData.map((tat, i) => (
          <div key={i} className="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4">
            <div className="text-xs text-gray-500 dark:text-gray-400 uppercase mb-2">{tat.stage}</div>
            <div className="flex items-end gap-2">
              <div className="text-2xl font-bold dark:text-gray-100">{tat.avg.toFixed(1)}</div>
              <div className="text-sm text-gray-500 dark:text-gray-400">days</div>
            </div>
            <div className="mt-2 text-xs">
              Target: <span className="font-medium text-indigo-600 dark:text-indigo-400">{tat.target} days</span>
            </div>
            <div className="mt-1 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5">
              <div 
                className={`h-1.5 rounded-full ${tat.avg <= tat.target ? 'bg-green-500' : 'bg-red-500'}`}
                style={{width: `${(tat.avg / tat.target) * 100}%`}}
              ></div>
            </div>
          </div>
        ))}
      </div>

      <Card title="TAT by Stage (Average Days)">
        <BarChart 
          labels={tatData.map(t => t.stage)}
          datasets={[
            {
              label: 'Actual TAT',
              data: tatData.map(t => t.avg),
              backgroundColor: '#4f46e5'
            },
            {
              label: 'Target TAT',
              data: tatData.map(t => t.target),
              backgroundColor: '#94a3b8'
            }
          ]}
          height={280}
        />
      </Card>

      <Card title="State-wise TAT Breakdown">
        <div className="overflow-x-auto">
          <table className="w-full text-sm">
            <thead className="text-gray-500 dark:text-gray-400 text-xs uppercase bg-gray-50 dark:bg-gray-700/50">
              <tr>
                <th className="py-3 px-4 text-left">State</th>
                <th className="py-3 px-4 text-center">Login â†’ Sanction</th>
                <th className="py-3 px-4 text-center">Login â†’ Decision</th>
                <th className="py-3 px-4 text-center">Sanction â†’ Disb</th>
                <th className="py-3 px-4 text-center">SOP Compliance</th>
                <th className="py-3 px-4 text-center">Overall Rating</th>
              </tr>
            </thead>
            <tbody>
              {data.map((d, i) => {
                const t1 = (2 + Math.random() * 2).toFixed(1);
                const t2 = (2.5 + Math.random() * 2).toFixed(1);
                const t3 = (3 + Math.random() * 2).toFixed(1);
                const t4 = (1.5 + Math.random() * 1).toFixed(1);
                const avg = ((parseFloat(t1) + parseFloat(t2) + parseFloat(t3) + parseFloat(t4)) / 4).toFixed(1);
                return (
                  <tr key={i} className="border-t border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <td className="py-3 px-4 font-medium">{d.state}</td>
                    <td className="py-3 px-4 text-center">{t1}d</td>
                    <td className="py-3 px-4 text-center">{t2}d</td>
                    <td className="py-3 px-4 text-center">{t3}d</td>
                    <td className="py-3 px-4 text-center">{t4}d</td>
                    <td className="py-3 px-4 text-center">
                      <span className={`px-2 py-1 rounded text-xs font-medium ${
                        avg < 2.5 ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' : 
                        avg < 3.5 ? 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200' : 
                        'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200'
                      }`}>
                        {avg < 2.5 ? 'Excellent' : avg < 3.5 ? 'Good' : 'Needs Improvement'}
                      </span>
                    </td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      </Card>
    </div>
  );
}

// Donut Chart Component
function DonutChart({ data, labels, colors }) {
  const canvasRef = useRef(null);
  const chartRef = useRef(null);

  useEffect(() => {
    if (canvasRef.current) {
      if (chartRef.current) {
        chartRef.current.destroy();
      }
      
      const isDark = document.documentElement.classList.contains('dark');
      const textColor = isDark ? '#e5e7eb' : '#1f2937';
      
      const ctx = canvasRef.current.getContext('2d');
      chartRef.current = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: colors,
            borderWidth: 2,
            borderColor: isDark ? '#1f2937' : '#ffffff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: textColor,
                padding: 15,
                font: { size: 12 }
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.parsed || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  return `${label}: ${value} (${percentage}%)`;
                }
              }
            }
          }
        }
      });
    }
    
    return () => {
      if (chartRef.current) {
        chartRef.current.destroy();
      }
    };
  }, [data, labels, colors]);

  return <canvas ref={canvasRef}></canvas>;
}

/* ------------------------------------------------------------
   COLLECTIONS DASHBOARD
------------------------------------------------------------ */
function CollectionsDashboard() {
  const resolutions = [
    { bucket: "X1", rate: "58%" },
    { bucket: "X2", rate: "41%" },
    { bucket: "X3", rate: "23%" },
    { bucket: "NPA", rate: "8%" },
  ];

  return (
    <div>
      <div className="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-6 gap-4 mb-6">
        <KPI label="CE (Current)" value="97.6%" tooltip="Current-month EMI collection vs demand." />
        <KPI label="CE (Overall)" value="94.3%" tooltip="Collections including arrears." />
        <KPI label="Bounce %" value="7.4%" tooltip="% of accounts that bounced in the current cycle." />
        <KPI label="Flow Rate" value="4.8%" tooltip="% of portfolio moving to higher buckets." />
        <KPI label="NPA Recovery" value="â‚¹1.48 Cr" tooltip="Recovered amount from NPA pool in period." />
        <KPI label="Non-Starters" value="112" tooltip="Cases that bounced from first EMI within 3 months." />
      </div>

      <div className="grid grid-cols-1 xl:grid-cols-2 gap-6">
        <Card title="Collection Efficiency Trend">
          <LineChart 
            labels={["Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct"]}
            datasets={[
              {
                label: 'CE (%)',
                data: [96.8, 97.3, 96.5, 97.8, 97.1, 97.4, 97.6],
                borderColor: '#2563eb',
                backgroundColor: '#2563eb',
                tension: 0.3
              }
            ]}
          />
        </Card>

        <Card title="Bucket-wise Portfolio (PAR Structure)">
          <BarChart 
            labels={["Current", "X1 (1-30 DPD)", "X2 (31-60 DPD)", "X3 (61-90 DPD)", "NPA (90+)"]}
            datasets={[
              {
                label: 'Portfolio %',
                data: [88.5, 6.1, 3.5, 1.5, 0.4],
                backgroundColor: '#4f46e5'
              }
            ]}
          />
        </Card>
      </div>

      <Card title="Vintage Curve (Flow to Higher Buckets)">
        <LineChart 
          labels={["M0", "M1", "M2", "M3", "M4", "M5"]}
          datasets={[
            {
              label: 'Flow %',
              data: [4.2, 6.1, 3.9, 2.8, 1.9, 1.1],
              borderColor: '#16a34a',
              backgroundColor: '#16a34a',
              tension: 0.3
            }
          ]}
        />
      </Card>

      <Card title="Bucket-wise Resolution Rate">
        <table className="w-full text-sm">
          <thead className="text-gray-700 dark:text-gray-200 text-xs uppercase font-semibold">
            <tr>
              <th className="pb-2 text-left">Bucket</th>
              <th className="pb-2 text-center">Resolution %</th>
            </tr>
          </thead>
          <tbody>
            {resolutions.map((r, i) => (
              <tr key={i} className="border-t border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-100">
                <td className="py-2 font-medium">{r.bucket}</td>
                <td className="text-center font-semibold">{r.rate}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </Card>
    </div>
  );
}

/* ------------------------------------------------------------
   CREDIT DASHBOARD
------------------------------------------------------------ */
function CreditDashboard() {
  return (
    <div>
      <div className="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-6 gap-4 mb-6">
        <KPI label="Approval %" value="58.1%" tooltip="Sanctions Ã· Logins." />
        <KPI label="Avg Deviations" value="1.8" tooltip="Average deviations per approved file." />
        <KPI label="Deviation % (Files)" value="34%" tooltip="Files with one or more deviations." />
        <KPI label="Policy Hit %" value="66%" tooltip="Applications meeting credit policy without deviation." />
        <KPI label="Decline Ratio" value="18%" tooltip="% of cases declined by credit." />
        <KPI label="1â€“3 MOB Default" value="2.4%" tooltip="Early delinquency rate for new book." />
      </div>

      <div className="grid grid-cols-1 xl:grid-cols-2 gap-6">
        <Card title="Bureau Score Band Mix (Disbursed Book)">
          <BarChart 
            labels={["300â€“600", "600â€“650", "650â€“700", "700â€“750", "750+"]}
            datasets={[
              {
                label: 'Percentage',
                data: [12, 19, 26, 23, 20],
                backgroundColor: '#4f46e5'
              }
            ]}
          />
        </Card>

        <Card title="Deviation Mix (By Type)">
          <BarChart 
            labels={["FOIR Breach", "LTV Breach", "Low Bureau Score", "Income Proof Issue", "Banking Variance"]}
            datasets={[
              {
                label: 'Count',
                data: [120, 72, 98, 56, 41],
                backgroundColor: '#f97316'
              }
            ]}
          />
        </Card>
      </div>

      <div className="grid grid-cols-1 xl:grid-cols-2 gap-6 mt-6">
        <Card title="Credit TAT by Stage">
          <BarChart 
            labels={["FI", "CPV", "UW", "Approval"]}
            datasets={[
              {
                label: 'Days',
                data: [1.6, 0.9, 1.4, 0.7],
                backgroundColor: '#10b981'
              }
            ]}
          />
        </Card>

        <Card title="Top Decline Reasons">
          <BarChart 
            labels={["Low Score", "Insufficient Income", "High FOIR", "Banking Negative", "LTV High"]}
            datasets={[
              {
                label: 'Count',
                data: [31, 22, 18, 14, 8],
                backgroundColor: '#dc2626'
              }
            ]}
          />
        </Card>
      </div>

      <Card title="Files With High Risk (Multiple Deviations / Low Score / Early Bounce)">
        <table className="w-full text-sm">
          <thead className="text-gray-700 dark:text-gray-200 text-xs uppercase font-semibold">
            <tr>
              <th className="py-2 text-left">Loan #</th>
              <th className="py-2 text-center">RO</th>
              <th className="py-2 text-center">Score</th>
              <th className="py-2 text-center">Deviations</th>
              <th className="py-2 text-center">DPD</th>
              <th className="py-2 text-center">Risk Flag</th>
            </tr>
          </thead>
          <tbody>
            {[
              { loan: "MSF10234", ro: "RO-01", score: 612, dev: 3, dpd: "22", flag: "High" },
              { loan: "MSF10391", ro: "RO-04", score: 588, dev: 2, dpd: "34", flag: "Critical" },
              { loan: "MSF10944", ro: "RO-02", score: 640, dev: 2, dpd: "15", flag: "Medium" },
            ].map((r, i) => (
              <tr key={i} className="border-t border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-100">
                <td className="py-2 font-semibold">{r.loan}</td>
                <td className="text-center">{r.ro}</td>
                <td className="text-center">{r.score}</td>
                <td className="text-center">{r.dev}</td>
                <td className="text-center">{r.dpd}</td>
                <td className="text-center font-semibold">{r.flag}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </Card>
    </div>
  );
}

/* ------------------------------------------------------------
   OPS DASHBOARD
------------------------------------------------------------ */
function OpsDashboard() {
  const exceptions = [
    { file: "FILE-2211", branch: "Jaipur Main", issue: "PAN mismatch", delay: "18 hrs" },
    { file: "FILE-2298", branch: "Udaipur", issue: "Banking incomplete", delay: "26 hrs" },
    { file: "FILE-2177", branch: "Ajmer", issue: "Missing RC copy", delay: "32 hrs" },
  ];

  return (
    <div>
      <div className="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-6 gap-4 mb-6">
        <KPI label="NACH Penetration" value="68%" tooltip="Percentage of cases with active NACH mandates." />
        <KPI label="eNACH Success" value="21%" tooltip="Percentage of cases where eNACH was successfully registered." />
        <KPI label="FTR %" value="92%" tooltip="First Time Right: Files approved without any rework." />
        <KPI label="Avg Ops TAT" value="23 hrs" tooltip="Average operational processing time from Ops â†’ Accounts." />
        <KPI label="Rework %" value="14%" tooltip="Percentage of files requiring at least one rework cycle." />
        <KPI label="PDC Exhaust Cases" value="29" tooltip="Cases where PDCs will be exhausted before tenure completion." />
      </div>

      <div className="grid grid-cols-1 xl:grid-cols-2 gap-6">
        <Card title="Repayment Mode Mix">
          <BarChart 
            labels={["NACH", "eNACH", "PDC", "Cash"]}
            datasets={[
              {
                label: 'Percentage',
                data: [68, 21, 9, 2],
                backgroundColor: '#4f46e5'
              }
            ]}
          />
        </Card>

        <Card title="Mandate Registration TAT (Success over Days)">
          <LineChart 
            labels={["Day 1", "Day 2", "Day 3", "Day 4", "Day 5"]}
            datasets={[
              {
                label: 'Success %',
                data: [62, 74, 81, 87, 92],
                borderColor: '#10b981',
                backgroundColor: '#10b981',
                tension: 0.3
              }
            ]}
          />
        </Card>
      </div>

      <div className="grid grid-cols-1 xl:grid-cols-2 gap-6 mt-6">
        <Card title="Ops Queue Aging (Avg Hours Spent)">
          <BarChart 
            labels={["Doc Verification", "Ops Review", "Compliance", "Accounts"]}
            datasets={[
              {
                label: 'Hours',
                data: [6.2, 8.1, 3.4, 4.7],
                backgroundColor: '#2563eb'
              }
            ]}
          />
        </Card>

        <Card title="First Time Right (FTR%) Trend">
          <LineChart 
            labels={["Apr", "May", "Jun", "Jul", "Aug", "Sep"]}
            datasets={[
              {
                label: 'FTR %',
                data: [82, 86, 89, 91, 88, 92],
                borderColor: '#4338ca',
                backgroundColor: '#4338ca',
                tension: 0.3
              }
            ]}
          />
        </Card>
      </div>

      <Card title="Top Rework Reasons">
        <BarChart 
          labels={["Document Missing", "Mismatch in KYC", "Incorrect Banking", "Signature Issues"]}
          datasets={[
            {
              label: 'Count',
              data: [42, 28, 18, 16],
              backgroundColor: '#f59e0b'
            }
          ]}
        />
      </Card>

      <Card title="Operational Exception Cases">
        <table className="w-full text-sm">
          <thead className="text-gray-700 dark:text-gray-200 text-xs uppercase font-semibold">
            <tr>
              <th className="py-2 text-left">File #</th>
              <th className="py-2 text-center">Branch</th>
              <th className="py-2 text-center">Issue</th>
              <th className="py-2 text-center">Delay</th>
            </tr>
          </thead>
          <tbody>
            {exceptions.map((e, i) => (
              <tr key={i} className="border-t border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-100">
                <td className="py-2 font-semibold">{e.file}</td>
                <td className="text-center">{e.branch}</td>
                <td className="text-center">{e.issue}</td>
                <td className="text-center font-semibold">{e.delay}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </Card>
    </div>
  );
}

/* ------------------------------------------------------------
   Render
------------------------------------------------------------ */
ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
